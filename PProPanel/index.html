<!DOCTYPE html>
<!--
/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
* Copyright 2020 Adobe
* All Rights Reserved.
*
* NOTICE: Adobe permits you to use, modify, and distribute this file in
* accordance with the terms of the Adobe license agreement accompanying
* it. If you have received this file from a source other than Adobe,
* then your use, modification, or distribution of it requires the prior
* written permission of Adobe. 
**************************************************************************/
-->
<html>
  <title>PProPanel</title>
  <head>
    <meta charset="utf-8" />
    <script src="./ext.js"></script>
    <script src="./lib/CSInterface.js"></script>
    <script src="./lib/jquery-1.9.1.js"></script>
    <script src="./lib/Vulcan.js"></script>
    <link id="ppstyle" href="css/style.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript">
      $(document).ready(function () {
        // For functions which require interaction at the JavaScript level, we provide these JQuery-based
        // handlers, instead of directly invoking ExtendScript .This gives the JavaScript layer a chance
        // to pass data into the ExtendScript layer, and process the results.

        // $("#toggleproxy").on("click", function (e) {
        // 	e.preventDefault();
        // 	var csInterface = new CSInterface();
        // 	csInterface.evalScript('$._PPP_.toggleProxyState()', mySetProxyFunction);
        // 	// csInterface.evalScript('$._PPP_.getProjectProxySetting()', myGetProxyFunction);
        // });

        // $("#checkforums").on("click", function (e) {
        // 	e.preventDefault();
        // 	var csInterface = new CSInterface();
        // 	csInterface.openURLInDefaultBrowser("https://forums.adobe.com/community/premiere/sdk");
        // });

        // $("#openfolder").on("click", function (e) {
        // 	e.preventDefault();
        // 	var csInterface = new CSInterface();
        // 	var OSVersion = csInterface.getOSInformation();
        // 	var path = csInterface.getSystemPath(SystemPath.EXTENSION);
        //
        // 	if (OSVersion) {
        // 		// The path always comes back with '/' path separators. Windows needs '\\'.
        // 		if (OSVersion.indexOf("Windows") >= 0) {
        // 			var sep = '\\';
        // 			path = path.replace(/\//g, sep);
        // 			window.cep.process.createProcess('C:\\Windows\\explorer.exe', path);
        // 		} else {
        // 			window.cep.process.createProcess('/usr/bin/open', path);
        // 		}
        // 	}
        // });

        $("#openlogfilefolder").on("click", function (e) {
          e.preventDefault();
          var csInterface = new CSInterface();
          var OSVersion = csInterface.getOSInformation();
          var userDataPath = csInterface.getSystemPath(SystemPath.USER_DATA);
          var justTheFirstBit = userDataPath.split("A");
          var actualDestinationPath = justTheFirstBit[0];

          var version =
            document
              .getElementById("version_string")
              .innerHTML.substring(5)
              .split(".")[0] + ".0";

          if (OSVersion) {
            // The path always comes back with '/' path separators. Windows needs '\\'.
            if (OSVersion.indexOf("Windows") >= 0) {
              actualDestinationPath =
                actualDestinationPath +
                "AppData/Roaming/Adobe/Premiere Pro/" +
                version +
                "/logs";
              var sep = "\\";
              actualDestinationPath = actualDestinationPath.replace(/\//g, sep);
              window.cep.process.createProcess(
                "C:\\Windows\\explorer.exe",
                actualDestinationPath
              );
            } else {
              actualDestinationPath =
                actualDestinationPath +
                "Preferences/Adobe/Premiere Pro/" +
                version +
                "/logs";
              window.cep.process.createProcess(
                "/usr/bin/open",
                actualDestinationPath
              );
            }
          }
        });

        // $("#readAPIdocs").on("click", function (e) {
        //   e.preventDefault();
        //   var csInterface = new CSInterface();
        //   csInterface.openURLInDefaultBrowser("http://ppro.aenhancers.com");
        // });

        $("#transcodeexternal").on("click", function (e) {
          e.preventDefault();
          var csInterface = new CSInterface();
          var OSVersion = csInterface.getOSInformation();
          var path = csInterface.getSystemPath(SystemPath.EXTENSION);

          if (OSVersion) {
            // The path always comes back with '/' path separators. Windows needs '\\'.
            if (OSVersion.indexOf("Windows") >= 0) {
              var sep = "\\\\";
              path = path.replace(/\//g, sep);
            } else {
              var sep = "/";
            }

            // Build a String to pass the path to the script.
            // (Sounds more complicated than it is.)

            path = path + sep + "payloads" + sep + "example.epr";

            var pre = "$._PPP_.transcodeExternal('";
            var post = "'";
            var postpost = ")";

            var whole_megillah = pre + path + post + postpost;

            csInterface.evalScript(whole_megillah);
          }
        });

        $("#saveaspng").on("click", function (e) {
          e.preventDefault();
          var csInterface = new CSInterface();
          var OSVersion = csInterface.getOSInformation();
          var path = csInterface.getSystemPath(SystemPath.EXTENSION);

          if (OSVersion) {
            // The path always comes back with '/' path separators. Windows needs '\\'.
            if (OSVersion.indexOf("Windows") >= 0) {
              var sep = "\\\\";
              path = path.replace(/\//g, sep);
            } else {
              var sep = "/";
            }

            // Build a String to pass the path to the script.
            // (Sounds more complicated than it is.)

            path = path + sep + "payloads" + sep + "png.epr";

            var pre = "$._PPP_.exportCurrentFrameAsPNG('";
            var post = "'";
            var postpost = ")";

            var whole_megillah = pre + path + post + postpost;

            csInterface.evalScript(whole_megillah);
          }
        });

        $("#transcodeusingdefaultpreset").on("click", function (e) {
          e.preventDefault();
          var csInterface = new CSInterface();
          var OSVersion = csInterface.getOSInformation();
          var path = csInterface.getSystemPath(SystemPath.EXTENSION);

          if (OSVersion) {
            // The path always comes back with '/' path separators. Windows needs '\\'.
            if (OSVersion.indexOf("Windows") >= 0) {
              var sep = "\\\\";
              path = path.replace(/\//g, sep);
            } else {
              var sep = "/";
            }

            // Build a String to pass the path to the script.
            // (Sounds more complicated than it is.)

            path = path + sep + "payloads" + sep + "example.epr";

            var pre = "$._PPP_.transcode('";
            var post = "'";
            var postpost = ")";

            var whole_megillah = pre + path + post + postpost;

            csInterface.evalScript(whole_megillah);
          }
        });
      });
    </script>
  </head>

  <body onLoad="onLoaded()">
    <a href="javascript:history.go(0)">Refresh panel</a>
    <p id="username">[uninitialized]</p>
    <p id="version_string">[uninitialized]</p>
    <!-- <p id="active_seq">[uninitialized]</p> -->
    <!-- <p id="proxies_on">Proxies enabled for sequence: </p> -->

    <div>
      <h2>Clip Markers</h2>
      <button
        class="controlBg textStyle"
        id="btn_PPRO87"
        onClick="evalScript('$._M_.importZoomChatToClips()')"
      >
        Import Zoom Chat
      </button>
    </div>

    <div>
      <h2>System</h2>
    </div>
    <div id="section1" class="sectionID">
      <!--		<button class="controlBg textStyle" id="btn_PPRO33" onClick="evalScript('$._PPP_.closeFrontSourceClip()')">Close front-most Source monitor clip</button>-->
      <!--		<button class="controlBg textStyle" id="btn_PPRO35" onClick="evalScript('$._PPP_.closeAllClipsInSourceMonitor()')">Close all clips in Source monitor</button>-->
      <!--		<button id="openfolder">Open PProPanel folder</button>-->
      <button id="openlogfilefolder">
        Open Premiere Pro's Log Files folder
      </button>
      <!--		<button class="controlBg textStyle" id="btn_PPRO7" onClick="evalScript('$._PPP_.pokeAnywhere()')">Detect Anywhere Server</button>-->
      <!--		<button class="controlBg textStyle" id="btn_PPRO71" onClick="evalScript('$._PPP_.enumerateTeamProjects()')">Identify open Team Projects</button>-->
      <!--		<button id="checkforums">Check SDK Forums</button>-->
      <!-- <button id="readAPIdocs">Read API documentation</button> -->
      <!-- <button
        class="controlBg textStyle"
        id="btn_PPRO49"
        onClick="evalScript('$._PPP_.turnOffStartDialog()')"
      >
        Turn off Start dialog
      </button> -->
    </div>
    <div>
      <h2>Metadata and Project manipulation</h2>
    </div>
    <div id="section3" class="sectionID">
      <!--		<button id="toggleproxy">Toggle proxies in active project</button>-->
      <button
        class="controlBg textStyle"
        id="btn_PPRO9"
        onClick="evalScript('$._PPP_.replaceMedia()')"
      >
        Replace media...
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO10"
        onClick="evalScript('$._PPP_.createSequenceMarkers()')"
      >
        Add sequence markers
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO16"
        onClick="evalScript('$._PPP_.addClipMarkers()')"
      >
        Add clip markers
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO17"
        onClick="evalScript('$._PPP_.updatePAR()')"
      >
        Update PAR
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO11"
        onClick="evalScript('$._PPP_.mungeXMP()')"
      >
        Manipulate XMP
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO14"
        onClick="evalScript('$._PPP_.updateAllProjectItems()')"
      >
        Update all media
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO15"
        onClick="evalScript('$._PPP_.modifyProjectMetadata()')"
      >
        Modify project metadata
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO23"
        onClick="evalScript('$._PPP_.setScratchDisk()')"
      >
        Set scratch disk path
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO27"
        onClick="evalScript('$._PPP_.randomizeSequenceSelection()')"
      >
        Randomize sequence selection
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO28"
        onClick="evalScript('$._PPP_.muteFun()')"
      >
        Mute fun!
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO29"
        onClick="evalScript('$._PPP_.onPlayWithKeyframes()')"
      >
        Manipulate keyframes
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO30"
        onClick="evalScript('$._PPP_.insertOrAppend()')"
      >
        insert or append to active sequence
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO56"
        onClick="evalScript('$._PPP_.insertOrAppendToTopTracks()')"
      >
        insert or append, to top tracks
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO31"
        onClick="evalScript('$._PPP_.overWrite()')"
      >
        overwrite at CTI
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO36"
        onClick="evalScript('$._PPP_.changeLabel()')"
      >
        Label first projectItem
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO21"
        onClick="evalScript('$._PPP_.addSubClip()')"
      >
        Create subclip
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO44"
        onClick="evalScript('$._PPP_.reportCurrentProjectSelection()')"
      >
        Report selection to Events panel
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO43"
        onClick="evalScript('$._PPP_.randomizeProjectSelection()')"
      >
        Randomize project selection
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO45"
        onClick="evalScript('$._PPP_.setOffline()')"
      >
        Make selected items offline
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO47"
        onClick="evalScript('$._PPP_.setAllOnline()')"
      >
        Online all offline
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO48"
        onClick="evalScript('$._PPP_.updateFrameRate()')"
      >
        Update framerate
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO50"
        onClick="evalScript('$._PPP_.changeMarkerColors()')"
      >
        Change marker colors
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO52"
        onClick="evalScript('$._PPP_.changeSeqTimeCodeDisplay()')"
      >
        Change sequence timecode display
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO32"
        onClick="evalScript('$._PPP_.saveCurrentProjectLayout()')"
      >
        Save Project layout
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO51"
        onClick="evalScript('$._PPP_.setProjectPanelMeta()')"
      >
        Load Project layout
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO12"
        onClick="evalScript('$._PPP_.exportSequenceAsPrProj()')"
      >
        New project from sequence
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO73"
        onClick="evalScript('$._PPP_.autoReframeActiveSequence()')"
      >
        Auto-reframe active sequence
      </button>
      <h2>Export</h2>
    </div>
    <div id="section4" class="sectionID">
      <button id="transcodeusingdefaultpreset">
        Transcode first project item
      </button>
      <button id="transcodeexternal">Transcode external file</button>
      <button id="saveaspng">Save sequence frame as .png</button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO41"
        onClick="evalScript('$._PPP_.consolidateProject()')"
      >
        Consolidate & Transfer project
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO20"
        onClick="evalScript('$._PPP_.dumpXMPFromAllProjectItems()')"
      >
        Dump XMP from all items
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO34"
        onClick="evalScript('$._PPP_.saveProjectCopy()')"
      >
        Save project copy...
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO4"
        onClick="evalScript('$._PPP_.saveProject()')"
      >
        Save project
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO26"
        onClick="evalScript('$._PPP_.exportFramesForMarkers()')"
      >
        Export frames for markers
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO6"
        onClick="evalScript('$._PPP_.exportFCPXML()')"
      >
        Export FCP XML
      </button>
      <button
        class="controlBg textStyle"
        id="btn_PPRO22"
        onClick="evalScript('$._PPP_.exportAAF()')"
      >
        Export sequence to AAF
      </button>
    </div>
  </body>
  <script>
    document.body.onbeforeunload = function () {
      var csInterface = new CSInterface();
      var OSVersion = csInterface.getOSInformation();
      var appVersion = csInterface.hostEnvironment.appVersion;
      var versionAsFloat = parseFloat(appVersion);

      csInterface.evalScript("$._PPP_.closeLog()");

      if (versionAsFloat < 10.3) {
        var path =
          "file:///Library/Application Support/Adobe/CEP/extensions/PProPanel/payloads/onbeforeunload.html";

        if (OSVersion.indexOf("Windows") >= 0) {
          path =
            "file:///C:/Program%20Files%20(x86)/Common%20Files/Adobe/CEP/extensions/PProPanel/payloads/onbeforeunload.html";
        }
        csInterface.openURLInDefaultBrowser(path);
      }
    };
  </script>
</html>
